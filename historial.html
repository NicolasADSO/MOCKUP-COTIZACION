<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Historial de Cotizaciones - Gadier Sistemas</title>

    <!-- === ESTILOS PRINCIPALES === -->
    <link rel="stylesheet" href="./assets/css/layout.css" />
    <link rel="stylesheet" href="./assets/css/sidebar.css" />
    <link rel="stylesheet" href="./assets/css/cotizacion.css" />

    <!-- Librer√≠as para regenerar PDF -->
    <script src="./assets/js/libs/jspdf.umd.min.js"></script>
    <script src="./assets/js/libs/jspdf.plugin.autotable.min.js"></script>
</head>

<body>

    <script>
        // Protecci√≥n: Si NO hay sesi√≥n ‚Üí enviar al login
        if (!localStorage.getItem("usuario_logueado")) {
            window.location.href = "login.html";
        }
    </script>

    <!-- ========== SIDEBAR ========== -->
    <div id="sidebar"></div>

    <!-- ========== CONTENIDO PRINCIPAL ========== -->
    <main class="main-content">

        <!-- === HEADER === -->
        <header class="navbar-fija">
            <h1>üìã Historial de Cotizaciones</h1>
        </header>

        <!-- === CONTENIDO === -->
        <div class="historial-container" style="padding: 20px; max-width: 1400px; margin: 0 auto;">

            <!-- Filtros -->
            <div class="filtros-panel"
                style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                <h3 style="margin: 0 0 15px 0; color: #990f0c;">üîç Filtrar Cotizaciones</h3>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">

                    <!-- B√∫squeda -->
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-weight: 500;">Buscar:</label>
                        <input type="text" id="filtroBuscar" placeholder="C√≥digo o cliente..."
                            style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" />
                    </div>

                    <!-- Cliente -->
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-weight: 500;">Cliente:</label>
                        <select id="filtroCliente"
                            style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <option value="">Todos</option>
                        </select>
                    </div>

                    <!-- Estado -->
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-weight: 500;">Estado:</label>
                        <select id="filtroEstado"
                            style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <option value="">Todos</option>
                            <option value="Borrador">Borrador</option>
                            <option value="Enviada">Enviada</option>
                            <option value="Aprobada">Aprobada</option>
                            <option value="Rechazada">Rechazada</option>
                        </select>
                    </div>

                    <!-- Fecha Desde -->
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-weight: 500;">Desde:</label>
                        <input type="date" id="filtroFechaDesde"
                            style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" />
                    </div>

                    <!-- Fecha Hasta -->
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-weight: 500;">Hasta:</label>
                        <input type="date" id="filtroFechaHasta"
                            style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" />
                    </div>

                    <!-- Bot√≥n Aplicar -->
                    <div style="display: flex; align-items: flex-end;">
                        <button id="btnAplicarFiltros"
                            style="width: 100%; padding: 8px; background: #990f0c; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 500;">
                            Aplicar Filtros
                        </button>
                    </div>

                </div>
            </div>

            <!-- Loading Spinner -->
            <div id="loadingSpinner" style="display: none; text-align: center; padding: 40px;">
                <div
                    style="display: inline-block; width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #990f0c; border-radius: 50%; animation: spin 1s linear infinite;">
                </div>
                <p style="margin-top: 10px; color: #666;">Cargando cotizaciones...</p>
            </div>

            <style>
                @keyframes spin {
                    0% {
                        transform: rotate(0deg);
                    }

                    100% {
                        transform: rotate(360deg);
                    }
                }
            </style>

            <!-- Tabla de Resultados -->
            <div id="tablaCotizaciones"
                style="background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                <!-- Se llenar√° din√°micamente -->
            </div>

            <!-- Paginaci√≥n -->
            <div id="paginacion" style="margin-top: 20px; text-align: center;">
                <!-- Se llenar√° din√°micamente -->
            </div>

        </div>

    </main>

    <!-- Modal para Cambiar Estado -->
    <div id="modalCambiarEstado" class="modal-cliente-overlay" style="display: none;">
        <div class="modal-cliente-contenedor" style="max-width: 400px;">
            <h2 style="color: #990f0c; margin: 0 0 10px 0;">üîÑ Cambiar Estado</h2>
            <p id="estadoActualTexto" style="margin-bottom: 20px; color: #666; font-size: 14px;"></p>

            <div style="display: grid; gap: 10px;">
                <button onclick="seleccionarEstado('Borrador')"
                    style="padding: 12px; background: #999; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 500; transition: transform 0.2s;">
                    üìù Borrador
                </button>
                <button onclick="seleccionarEstado('Enviada')"
                    style="padding: 12px; background: #2196F3; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 500; transition: transform 0.2s;">
                    üì§ Enviada
                </button>
                <button onclick="seleccionarEstado('Aprobada')"
                    style="padding: 12px; background: #4CAF50; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 500; transition: transform 0.2s;">
                    ‚úÖ Aprobada
                </button>
                <button onclick="seleccionarEstado('Rechazada')"
                    style="padding: 12px; background: #f44336; color: white; border-radius: 6px; cursor: pointer; font-weight: 500; transition: transform 0.2s;">
                    ‚ùå Rechazada
                </button>
            </div>

            <button onclick="cerrarModalEstado()"
                style="margin-top: 20px; width: 100%; padding: 10px; background: #ddd; color: #333; border: none; border-radius: 6px; cursor: pointer; font-weight: 500;">
                Cancelar
            </button>
        </div>
    </div>

    <style>
        #modalCambiarEstado button:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
    </style>

    <!-- === SCRIPT PARA CARGAR SIDEBAR === -->
    <script>
        async function loadSidebar() {
            try {
                const container = document.getElementById("sidebar");
                const res = await fetch("./includes/sidebar.html");
                const html = await res.text();
                container.innerHTML = html;
            } catch (error) {
                console.error("Error loading sidebar:", error);
            }
        }
        loadSidebar();
    </script>

    <!-- === SCRIPTS PRINCIPALES === -->
    <script src="./assets/js/sidebar.js"></script>
    <script src="./assets/js/auth.js"></script>
    <script src="./assets/js/procesos_data.js"></script>
    <script src="./assets/js/pdf_gadier.js"></script>
    <script src="./assets/js/historial.js"></script>

</body>

</html>